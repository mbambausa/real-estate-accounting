---
// src/pages/auth/signout.astro
import AuthLayout from "@layouts/AuthLayout.astro";
import Button from "@components/ui/Button.astro";
import { getCurrentUserId, getSession } from '@lib/auth';

// Get session info to display user details
const userId = await getCurrentUserId(Astro.request, Astro.locals.runtime.env);
const session = await getSession(Astro.request, Astro.locals.runtime.env);
const userName = session?.user?.name;
const userEmail = session?.user?.email;
---

<AuthLayout title="Sign Out">
  <div class="w-full max-w-sm mx-auto">
    <div class="text-center mb-8">
      <a href="/" class="inline-block mb-4">
        <svg class="w-16 h-16 text-primary-600 mx-auto" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M3.75 3A.75.75 0 003 3.75v16.5c0 .414.336.75.75.75h16.5A.75.75 0 0021 20.25V3.75A.75.75 0 0020.25 3H3.75zM6.5 6.25a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75zm0 3.5a.75.75 0 01.75-.75h6.5a.75.75 0 010 1.5h-6.5a.75.75 0 01-.75-.75zm0 3.5a.75.75 0 01.75-.75H17a.75.75 0 010 1.5H7.25a.75.75 0 01-.75-.75zm.75 2.75a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5z" clip-rule="evenodd" />
        </svg>
      </a>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Sign Out</h1>
      <p class="text-sm text-gray-600 mt-2">Are you sure you want to sign out?</p>
      
      {userName || userEmail ? (
        <p class="mt-2 text-sm font-medium text-gray-600">
          Account: {userName || ''} {userName && userEmail ? <span class="text-gray-400">â€¢</span> : ''} 
          {userEmail && <span class="text-gray-500">{userEmail}</span>}
        </p>
      ) : null}
    </div>

    <form
      method="POST"
      action="/api/auth/signout?redirect=true&callbackUrl=/auth/signin"
      class="bg-white shadow-xl rounded-lg px-6 py-8 sm:px-8 sm:py-10 border border-gray-200"
    >
      <Button type="submit" variant="danger" fullWidth={true} size="md">
        Confirm Sign Out
      </Button>
    </form>
    
    <p class="mt-8 text-center text-sm text-gray-600">
      Changed your mind? 
      <a href="/app/dashboard" class="font-medium text-primary-600 hover:text-primary-500 hover:underline">
        Go to Dashboard
      </a>
    </p>
  </div>
</AuthLayout>